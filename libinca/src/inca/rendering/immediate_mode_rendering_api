/* -*- C++ -*-
 *
 * File:
 *
 * Author: Ryan L. Saunders
 *
 * Copyright 2004, Ryan L. Saunders. All rights reserved.
 *
 * Description:
 */

#ifndef INCA_RENDERING_IMMEDIATE_MODE_RENDERING_API
#define INCA_RENDERING_IMMEDIATE_MODE_RENDERING_API

// Import system configuration
#include <inca/inca-common.h>

// This is part of the Inca rendering subsystem
namespace inca {
    namespace rendering {
        // Forward declarations
        template <typename api> struct immediate_mode_rendering_api;
    };
};


// Import math and imaging types
#include <inca/math.hpp>
#include <inca/imaging.hpp>

#include <inca/world.hpp>

// Import rendering types
#include <inca/rendering/types.hpp>


template <typename api>
struct inca::rendering::immediate_mode_rendering_api {
public:
    // Geometric typedefs
    INCA_MATH_SCALAR_TYPEDEFS(double, IS_WITHIN_TEMPLATE, /* */, /* */);
    typedef inca::math::Point<scalar_t, 2>          Point2D;
    typedef inca::math::Vector<scalar_t, 2>         Vector2D;

    typedef inca::math::Point<scalar_t, 3>          Point3D;
    typedef inca::math::Vector<scalar_t, 3>         Vector3D;

    typedef inca::math::Matrix<double, 4, 4, false> Matrix;

    static void check_for_error();


/*---------------------------------------------------------------------------*
 | Framebuffer control functions
 *---------------------------------------------------------------------------*/
public:
    static void allocate_offscreen_framebuffer();
    static void clear_framebuffer();
    static void resize_framebuffer(size_t w, size_t h);


/*---------------------------------------------------------------------------*
 | Rendering-state control functions
 *---------------------------------------------------------------------------*/
public:
    static void lock_z_buffer(bool locked);
    static bool is_z_buffer_locked();
    static void enable_z_buffer(bool enabled);
    static bool is_z_buffer_enabled();
    static void enable_culling(bool enabled);
    static bool is_culling_enabled();
    static void enable_alpha_blending(bool enabled);
    static bool is_alpha_blending_enabled();
    static void enable_lighting(bool enabled);
    static bool is_lighting_enabled();
    static void enable_point_smoothing(bool enabled);
    static bool is_point_smoothing_enabled();
    static void set_point_size(float size);
    static void enable_line_smoothing(bool enabled);
    static bool is_line_smoothing_enabled();
    static void set_line_width(float width);

    static void set_shading_mode(ShadingMode mode);
    static ShadingMode shading_mode();
    static void set_fill_mode(FillMode mode);
    static FillMode fill_mode();

    template <typename scalar_t, imaging::ColorSpace cs, bool hasAlpha>
    static void set_background_color(
        const imaging::Color<scalar_t, cs, hasAlpha> &c);

    template <typename scalar_t, imaging::ColorSpace cs, bool hasAlpha>
    static void set_drawing_color(
        const imaging::Color<scalar_t, cs, hasAlpha> &c);

    template <typename scalar_t, size_t dim>
    static void set_normal(const math::Vector<scalar_t, dim> &n);

    template <typename scalar_t, size_t dim>
    static void set_texture_coordinates(const math::Point<scalar_t, dim> &t);


/*---------------------------------------------------------------------------*
 | Transformation matrix functions
 *---------------------------------------------------------------------------*/
public:
    static void select_projection_matrix();
    static void select_transformation_matrix();
    static void reset_matrix();
    static void push_matrix();
    static void pop_matrix();
    static void multiply_matrix(const Matrix &m);

    static void save_projection_matrix(Matrix &m);
    static void load_projection_matrix(const Matrix &m);
    static void save_transformation_matrix(Matrix &m);
    static void load_transformation_matrix(const Matrix &m);

    static void apply_orthographic_projection(const Vector2D &extents,
                                              const Vector2D &clip);
    static void apply_perspective_projection(const Vector2D &angles,
                                             const Vector2D &clip);
    static void apply_picking_projection(const Point2D &center,
                                         const Vector2D &size);

    template <typename scalar_t, size_t dim>
    static void apply_translation(const math::ScalarList<scalar_t, dim> &t);
    template <typename scalar_t, size_t dim>
    static void unapply_translation(const math::ScalarList<scalar_t, dim> &t);
    template <typename scalar_t>
    static void apply_rotation(const math::Quaternion<scalar_t> &q);
    template <typename scalar_t, size_t dim>
    static void apply_rotation(scalar_arg_t angle,
                               const math::Vector<scalar_t, dim> &axis);
    template <typename scalar_t>
    static void unapply_rotation(const math::Quaternion<scalar_t> &q);
    template <typename scalar_t, size_t dim>
    static void unapply_rotation(scalar_arg_t angle,
                               const math::Vector<scalar_t, dim> &axis);
    template <typename scalar_t, size_t dim>
    static void apply_scaling(const math::ScalarList<scalar_t, dim> &s);
    template <typename scalar_t, size_t dim>
    static void unapply_scaling(const math::ScalarList<scalar_t, dim> &s);

    template <typename scalar_t, size_t dim>
    static void transform(const math::Point<scalar_t, dim> &world,
                                math::Point<scalar_t, dim> &local);

    template <typename scalar_t, size_t dim>
    static void untransform(const math::Point<scalar_t, dim> &local,
                                  math::Point<scalar_t, dim> &world);

    template <typename scalar_t, size_t dim>
    static void project(const math::Point<scalar_t, dim> &world,
                              math::Point<scalar_t, dim> &screen);

    template <typename scalar_t, size_t dim>
    static void unproject(const math::Point<scalar_t, dim> &screen,
                                math::Point<scalar_t, dim> &world);


/*---------------------------------------------------------------------------*
 | Selection functions
 *---------------------------------------------------------------------------*/
public:
    static void enable_selection_mode(bool selection);
    static bool is_selection_mode_enabled();
    static void load_selected_ids(inca::world::SelectionSet &s);

    static void clear_selection_id_stack();
    static void set_selection_id(unsigned int id);
    static void push_selection_id(unsigned int id);
    static void pop_selection_id();


/*---------------------------------------------------------------------------*
 | Rendering functions
 *---------------------------------------------------------------------------*/
public:
    static void begin_render_immediate(PrimitiveType type);
    static void end_render_immediate();

    template <typename scalar_t, size_t dim>
    static void render_vertex(const math::Point<scalar_t, dim> &p);
};

#endif

